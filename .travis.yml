language: php

php:
  - 5.6

branches:
  only:
    - service/travis

addons:
  apt:
    packages:
    - php5-dev

before_install:
  - wget https://github.com/phpredis/phpredis/archive/develop.zip && unzip develop.zip && cd phpredis-develop
  - phpize
  - ./configure
  - make
  - sudo make install
  - sudo mkdir -p /etc/php5/cli/conf.d/
  - echo 'extension='`pwd`'/modules/redis.so' | sudo tee /etc/php5/cli/conf.d/redis.ini > /dev/null
  - echo 'extension='`pwd`'/modules/redis.so' | sudo tee /etc/php5/conf.d/redis.ini > /dev/null
  - cd ../
  - cat /etc/php5/cli/conf.d/redis.ini
  - cat /etc/php5/conf.d/redis.ini
  - php -r 'echo "|".php_ini_loaded_file()."|\n";'

install:
  - composer install --no-dev

services:
  - redis-server

script: phpunit --configuration phpunit.xml.dist --coverage-text